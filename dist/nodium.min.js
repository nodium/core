!function e(t,n,s){function r(a,o){if(!n[a]){if(!t[a]){var h="function"==typeof require&&require;if(!o&&h)return h(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return r(n?n:e)},d,d.exports,e,t,n,s)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<s.length;a++)r(s[a]);return r}({1:[function(e){!function(t){t.Nodium=e("./nodium")}(window)},{"./nodium":2}],2:[function(e,t){(function(e){t.exports=function(){var t="undefined"!=typeof window?window._:"undefined"!=typeof e?e._:null,n="undefined"!=typeof window?window.d3:"undefined"!=typeof e?e.d3:null,s="undefined"!=typeof window?window.$:"undefined"!=typeof e?e.$:null;return this.app={context:{_:t,d3:n,jQuery:s}},function(e){e.setNamespace=function(t){var n,s,r,i=t.split("."),a=e;for(s=0,r=i.length;r>s;s++)n=i[s],a[n]=a[n]||{},a=a[n];return a}}(this),function(e){e.use=function(t){for(var n,s=t.split("."),r=e;n=s.shift();)r=r[n]||{};return r}}(this),function(e){var t=e.setNamespace("app");e.window&&(t.clearTimeout=window.clearTimeout.bind(e),t.setTimeout=window.setTimeout.bind(e),t.open=window.open.bind(e))}(this),function(e){var t=e.setNamespace("app.util");t["super"]=function(e){var e,t,n=Object.getPrototypeOf(Object.getPrototypeOf(this));return t=[].slice.call(arguments,1),n.hasOwnProperty(e)?n[e].apply(this,t):void 0}}(this),function(e){var t=(e.setNamespace("app.util"),e.use("app")),n=e.use("app.util.super"),s=!1;t.createClass=function(){var e,t,r,i,a,o;if(o=[].slice.call(arguments,0),"function"==typeof o[0]&&(t=o.shift()),i=o.shift(),e=function(){if(!1==this instanceof e)return new e(arguments);if(Object.getPrototypeOf(this).hasOwnProperty("construct")||(s=!0),this.construct&&"function"==typeof this.construct){var t=[].slice.call(arguments,0);t.unshift("construct"),this["super"].apply(this,t),s||this.construct.apply(this,t.slice(1))}s=!1},null!=t){s=!0,r=new t;for(a in i)i.hasOwnProperty(a)&&(r[a]=i[a])}else i["super"]=n;return e.prototype=r||i,e}}(this),function(e){function t(e,t){var s=e.data("prototype");return n.stringFromTemplate(s,t)}var n=e.setNamespace("app.util");n.createFromPrototype=t}(this),function(e){e.getFunction=function(t){for(var n,s=t.split("."),r=e;n=s.shift();){if(!r[n])return null;r=r[n]}return"function"==typeof r?r:null}}(this),function(e){e.getObjectValueByPath=function(t,n){for(var s,r=e.getPathArray(n);r.length;){if(s=r.shift(),!(s in t))return;t=t[s]}return t}}(this),function(e){e.getPathArray=function(e){var t;return"string"==typeof e?(e=e.replace(/\[(\w+)\]/g,".$1"),e=e.replace(/^\./,""),t=e.split(".")):t=e,t}}(this),function(e){e.partial=function(t,n){var s,r=Array.prototype.slice,i=Array.prototype.concat;return s=n?r.call(arguments,2):r.call(arguments,1),s=i.apply([],s),n=n||e,function(){return t.apply(n,s.concat(r.call(arguments)))}}}(this),function(e,t){e.removeByPath=function(n,s,r){for(var i,a=e.getPathArray(s),o=r===t?a.length-1:a.length;o;o--){if(i=a.shift(),!(i in n))return!1;n=n[i]}if(r===t)return i=a.shift(),Array.isArray(n)?(i=parseInt(i,10),isNaN(i)?!1:(n.splice(i,1),!0)):"object"==typeof n?(delete n[i],!0):!1;if(Array.isArray(n))return i=n.indexOf(r),-1===i?!1:(n.splice(i,1),!0);throw"object"==typeof n?"Cannot remove value from object":"Cannot remove value from this type"}}(this),function(e){e.setByPath=function(t,n,s){for(var r,i=e.getPathArray(n),a=!1;i.length-1;)r=i.shift(),r in t||(a=!0,t[r]={}),t=t[r];if(r=i.shift(),r in t||(a=!0),Array.isArray(t)){if(r=parseInt(r,10),isNaN(r))return!1;-1===r?t.push(s):t.splice(r,0,s)}else{if("object"!=typeof t)throw"Cannot remove value from this type";t[r]=s}return a}}(this),function(e,t){function n(e,n){return t.reduce(n,s,e)}function s(e,t,n){return e.replace(new RegExp("{"+n+"}","g"),t)}var r=e.setNamespace("app.util");r.stringFromTemplate=n}(this,t),function(e){var t=e.setNamespace("app.util");t.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}}(this),function(e){var t,n=e.setNamespace("app.event");t={START:"drag-start",DRAG:"drag",END:"drag-end"},n.DragEvent=t}(this),function(e){var t,n=e.setNamespace("app.event");t={CREATE:"edge-create",REPLACE:"edge-replace",UPDATE:"edge-update",DESTROY:"edge-delete",SELECT:"edge-select",UNSELECT:"edge-unselect",CREATED:"edge-created",REPLACED:"edge-replaced",UPDATED:"edge-updated",DESTROYED:"edge-destroyed",SELECTED:"edge-selected",UNSELECTED:"edge-unselected",DRAWN:"edge-drawn",MODECHANGE:"edge-mode-change",MODECHANGED:"edge-mode-change"},n.EdgeEvent=t}(this),function(e){var t=e.setNamespace("app.event");const n={CHANGE:"change",CLICK:"click",FOCUS_OUT:"focusout",INPUT:"input",KEY_DOWN:"keydown",KEY_UP:"keyup",MOUSE_DOWN:"mousedown",MOUSE_DRAG:"mousedrag",MOUSE_MOVE:"mousemove",MOUSE_UP:"mouseup",PASTE:"paste",POP_STATE:"popstate",SCROLL:"scroll",SUBMIT:"submit"};t.Event=n}(this),function(e,t){var n=e.setNamespace("app.event"),s=e.use("app"),r=function(e){return e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})};n.EventAware=s.createClass({construct:function(){this.events=[]},destroy:function(){var e;for(e=this.events.length;e>0;e--)this.off.apply(this,this.events[e-1])},off:function(){var e,t,n=Array.prototype.slice.call(arguments,0);return n.length>1&&(e=n.shift()),t=this.resolveSelector(),t.off.apply(t,n),index=this.events.indexOf(n),-1!==index&&(this.events=this.events.splice(index,1)),this},on:function(e){var t,n,s,r=Array.prototype.slice.call(arguments,1);return r.length>1&&(n=r.shift()),t=r[0],r.push(this.resolveEvent(t,e)),s=this.resolveSelector(n),s.on.apply(s,r),this.events.push(r.unshift(n)),this},resolveEvent:function(e,t){var n,s=r(["handle",e].join("-"));if(n=t[s],n&&"function"==typeof n)return n.bind(t);throw new Error("Could not resolve "+e+" to function.")},resolveSelector:function(){return t(this)}})}(this,s),function(e){var t,n=e.setNamespace("app.event");t={NODE:"holding-node",CANVAS:"holding-canvas",DRAGDOWN:"hold-drag-down",DRAGUP:"hold-drag-up",DRAGLEFT:"hold-drag-left",DRAGRIGHT:"hold-drag-right"},n.HoldEvent=t}(this),function(e,t){"use strict";var n=e.setNamespace("app.event"),s=e.use("app.event.EventAware"),r=e.use("app");n.Kernel=r.createClass(s,{register:function(e,t){return e.kernel=this,t&&this.attachModuleEvents(e,t),"function"==typeof e.initialize&&e.initialize(),this},attachModuleEvents:function(n,s){for(var r,i,a,o,h=[],l=0;l<s.length;l++)r=s[l],i=r[0],i&&(a=r.slice(1),h=a.slice(1),a=a[0],a&&(o=n[a]&&"function"==typeof n[a]?n[a]:e.getFunction(a),o&&t(this).on(i,e.partial(o,n,h))))}})}(this,s,n,t),function(e){var t=e.setNamespace("app.event");const n={ESCAPE:"key-escape"};t.KeyboardEvent=n}(this),function(e){var t=e.setNamespace("app.event");const n={CREATE:"node-create",UPDATE:"node-update",UPDATEPROPERTY:"node-update-property",UPDATELABEL:"node-update-label",DESTROY:"node-delete",SELECT:"node-select",UNSELECT:"node-unselect",CREATED:"node-created",UPDATED:"node-updated",UPDATEDPROPERTY:"node-updated-property",UPDATEDLABEL:"node-updated-label",DESTROYED:"node-destroyed",SELECTED:"node-selected",UNSELECTED:"node-unselected",FILTER:"node-filter",FILTERED:"node-filtered",FILTER_UNSET:"node-filter-unset",DRAWN:"node-drawn",LOADED:"graph-loaded"};t.NodeEvent=n}(this),function(e,t,n){var s=e.setNamespace("app.model");const r="_id",i="_labels",a="_properties";s.Node={create:function(e,s,o){var h={};return h[a]=e||{},h[i]=s||[],h[r]=o===n?t.uniqueId():o,h},getId:function(t){return e.getObjectValueByPath(t,r)},getIdPath:function(){return r},getLabelsPath:function(e){var t=i;return e&&(t+="."+e),t},getPropertiesPath:function(e){var t=a;return e&&(t+="."+e),t},getLabels:function(t){return e.getObjectValueByPath(t,i)},getProperties:function(t){return e.getObjectValueByPath(t,a)},getPropertyValue:function(t,n){var s=this.getPropertiesPath(n);return e.getObjectValueByPath(t,s)},filterEdges:function(e,t){var n=this.getId(e);return t.filter(function(e){var t=this.getId(e.source),s=this.getId(e.target);return t===n||s===n},this)},hasProperty:function(t,s){var r=this.getPropertiesPath(s);return e.getObjectValueByPath(t,r)!==n},hasPropertyWithValue:function(t,n,s){var r=this.getPropertiesPath(n),i=e.getObjectValueByPath(t,r);return s===i},hasLabel:function(e,t){var n=s.Node.getLabels(e);return-1!==n.indexOf(t)}}}(this,t),function(e,t,n){"use strict";var s=e.setNamespace("app.model"),r=e.use("app");s.Node2=r.createClass({construct:function(e,n,s,r,i){this._id=e||0===e?e:t.uniqueId(),this._properties=n||{},this._mapped=s||{},this._labels=r||[],t.forOwn(i,function(e,t){if(this.hasOwnProperty(t))throw"node attribute conflict";this[t]=e},this)},addLabel:function(e){return this.hasLabel(e)||this._labels.push(e),this},filterEdges:function(e){return e.filter(function(e){var t=e.source.getId(),n=e.target.getId();return t===id||n===id},this)},getId:function(){return this._id},getLabels:function(){return this._labels},getProperties:function(){return this._properties},getProperty:function(e){return this._properties[e]},getMapped:function(){return this._mapped},hasLabel:function(e){return t.includes(this.getLabels(),e)},hasProperty:function(e){return t.has(this.getProperties(),e)},hasPropertyWithValue:function(e,t){return this.getProperty(e)===t},removeLabel:function(e){return t.remove(this._labels,e)},removeProperty:function(e,s){if(s===n||this.hasPropertyWithValue(e,s)){var r=t.pick(this._properties,e);return delete this._properties[e]?r:null}},setLabels:function(e){return this._labels=e,this},setProperty:function(e,t){return this._properties[e]=t,this}})}(this,t),function(e,t){"use strict";var n=e.setNamespace("app.model"),s=e.use("app.model.Node");n.Update=app.createClass({construct:function(){this._set=[],this._unset=[],this.difference,this.paths,this.count},set:function(e,t){this._set.push([e,t])},unset:function(e,t){this._unset.push([e,t])},setProperties:function(e){this.set(s.getPropertiesPath(),e)},setProperty:function(e,t){this.set(s.getPropertiesPath(e),t)},unsetProperty:function(e){this.unset(s.getPropertiesPath(e))},setLabels:function(e){this.set(s.getLabelsPath(),e)},setLabel:function(e){this.set(s.getLabelsPath(-1),e),console.log(this)},unsetLabel:function(e){this.unset(s.getLabelsPath(),e)},process:function(n){var s,r,i,a=this._set,o=this._unset,h=t.cloneDeep(n);if(o)for(s=0;s<o.length;s++)r=o[s],e.removeByPath(n,r[0],r[1]);if(a)for(s=0;s<a.length;s++)r=a[s],e.setByPath(n,r[0],r[1]);i=DeepDiff.diff(h,n),this.prepareDifference(i)},prepareDifference:function(e){var t,n,s,r,i={},a=0;if(e=e||[],this.difference=e,!e)return this.paths=i,void(this.count=0);for(s=0;s<e.length;s++)if(n=e[s],n.path){for(t="",r=0;r<n.path.length;r++)""!==t&&(t+="."),t+=n.path[r],i[t]=1;a++}this.paths=i,this.count=a},changed:function(e){return this.paths.hasOwnProperty(e)}})}(this,t),function(e,t){"use strict";var n=e.setNamespace("app.api"),s=e.use("app"),r=e.use("app.model"),i=e.use("app.event.NodeEvent"),a=e.use("app.event.EdgeEvent");n.APIConsumer=s.createClass({construct:function(e){this.api=e},initialize:function(){t(this.kernel).on(i.CREATED,this.handleNodeCreated.bind(this)),t(this.kernel).on(i.DESTROYED,this.handleNodeDeleted.bind(this)),t(this.kernel).on(a.CREATED,this.handleEdgeCreated.bind(this)),t(this.kernel).on(a.DESTROYED,this.handleEdgeDeleted.bind(this)),t(this.kernel).on(i.UPDATED,this.handleNodeUpdated.bind(this)),t(this.kernel).on(i.UPDATED,this.handleNodeLabelUpdated.bind(this))},executeIfExists:function(e){var t,n;return n=this.api[e],"function"==typeof n?(t=arguments.slice(1),n.apply(this.api,t)):void 0},get:function(e){this.executeIfExists("getGraph").then(e)},handleNodeCreated:function(e,t,n){this.executeIfExists("createNode",n)},handleNodeDeleted:function(e,t){this.executeIfExists("deleteNode",t)},handleEdgeCreated:function(e,t,n,s){this.executeIfExists("createEdge",{from:n,to:s}).then(function(e){t._id=e})},handleEdgeDeleted:function(e,t){this.executeIfExists("deleteEdge",{id:t.id})},handleNodeUpdated:function(e,t,n,s){(s.changed(r.Node.getPropertiesPath())||s.changed("_style"))&&this.executeIfExists("updateNode",n)},handleNodeLabelUpdated:function(e,t,n,s){s.changed(r.Node.getLabelsPath())&&this.executeIfExists("updateNodeLabels",n)}})}(this,s),function(e){var t=e.setNamespace("app.constants");const n={LEFT:1,RIGHT:2,UP:3,DOWN:4};t.Drag=n}(this),function(e){"use strict";var t=e.setNamespace("app.constants");t.EvaluationStrategy={LABEL:"label",PROPERTY:"property"}}(this),function(e){var t=e.setNamespace("app.constants");const n={ACCEPTED:"accepted",DENIED:"denied",PENDING:"pending"};t.NodeStatus=n}(this),function(e,t,n,s,r){"use strict";{var i,a=e.setNamespace("app.graph"),o=e.use("app.event"),h=e.use("app"),l=e.use("app.constants.Drag"),d=e.use("app.event.NodeEvent"),u=e.use("app.event.DragEvent");e.use("app.event.HoldEvent")}a.Graph=h.createClass({construct:function(e,t){this.selector=e,this.kernel=t||new o.Kernel,this.draggedNode=null,this.dragging=!1,this.dragDirection=0,this.hoveredNode=null,this.visibleNodes=null,this.visibleEdges=null,this.options={shapes:{generator:"symbol"}},i=this},register:function(e,t){return e.graph=this,this.kernel.register(e,t),this},getGraphData:function(){var e=t(this.selector).data("graph");t(this.selector).attr("data-graph",null),this.handleGraphData(e)},handleGraphData:function(e){var n;this.nodes=e.nodes||[],this.edges=e.edges||[],this.force=this.createForce(),this.force.start(),this.drawLinks(),this.drawNodes(),n=s.bind(this.handleTick,this),this.force.on("tick",n),this.handleWindowResize(),t(this.kernel).trigger(d.LOADED,[this.nodes,this.edges])},createForce:function(){var e;return e=n.layout.force().charge(-2500).linkDistance(function(e){return i.getLinkDistance(e)}).size([1e4,1e4]).nodes(this.nodes).links(this.edges).linkStrength(function(){return 1})},initialize:function(){var n=s.bind(this.handleWindowResize,this);t(e).on("resize",n),this.initializeViewport(),this.getGraphData()},initializeViewport:function(){n.select(this.selector+" .graph-viewport").attr("transform",function(){var e=.2,t="-220, -700",n="translate(__translate__) scale(__scale__)",s=n.replace(/__translate__/g,t).replace(/__scale__/g,e);return s})},getNodeRadius:function(){return 25},getLinkDistance:function(e){var t,n,s=50;return e.source.r&&e.target.r?s+=e.source.r+e.target.r:(t=this.getNodeRadius(e.source),n=this.getNodeRadius(e.target),s+=t+n),s},getEventsObject:function(){var e={dragstart:s.partial(this.handleNodeDragStart,this),drag:s.partial(this.handleNodeDrag,this),dragend:s.partial(this.handleNodeDragEnd,this),mouseover:s.partial(this.handleMouseOver,this),mouseout:s.partial(this.handleMouseOut,this),click:s.partial(this.handleMouseClick,this),mouseup:s.partial(this.handleMouseUp,this),mousedown:s.partial(this.handleMouseDown,this)};return e},getNodeClassValue:function(){return"node"},getLinkClassValue:function(){return"link"},getVisibleNodes:function(){return this.nodes},redrawNodes:function(){n.select(this.selector+" .nodes").selectAll(".node").remove(),this.drawNodes()},redrawNode:function(e,s){(e||s)&&(e||s===r||(e=t(".node").get(s.index)),n.select(e).remove(),this.drawNodes())},drawNodes:function(){var e=this.getVisibleNodes(),t=n.select(this.selector+" .nodes").selectAll(".node").data(e,function(e,t){return e.hasOwnProperty("_id")?e._id:t}),s=t.enter().append("g");return this.drawNodeExit(t.exit()),this.attachNodeEvents(s),this.drawNodeEnter(s),this.node=t,this},attachNodeEvents:function(e){var t=this.getEventsObject();e.on("click",t.click).on("mouseover",t.mouseover).on("mouseout",t.mouseout).on("mouseup",t.mouseup).on("mousedown",t.mousedown).call(n.behavior.drag().on("dragstart",t.dragstart).on("drag",t.drag).on("dragend",t.dragend))},getNodeShapeGenerator:function(){var e=this.options.shapes.generator;return"symbol"==e?n.svg.symbol().type("circle").size(function(e){return Math.pow(i.getNodeRadius(e)*Math.PI,2)}):n.superformula().type("circle").size(function(e){return Math.pow(i.getNodeRadius(e)*Math.PI,2)}).segments(50)},drawNodeEnter:function(e){var n=this.getNodeShapeGenerator();e.attr("class",function(e){return i.getNodeClassValue(e)}),e.append("path").attr("d",function(e,t){var s=n(e,t);return e._shape={path:s,scale:{x:1,y:1},shape:"circle"},s}).attr("class","top-circle"),this.drawNodeTexts(e),t(this.kernel).trigger(d.DRAWN,[e])},drawNodeExit:function(e){e.remove()},splitNodeText:function(e,t){var n,s,r,i,a=e.length/2;if(t=t||10,!e||e.length<t||""===e)return[e];n=e.split(" "),r=n[0];for(var o=1;o<n.length;o++){if(s=n[o],i=Math.abs(a-r.length),!(Math.abs(a-(r.length+s.length+1))<i))return[r,n.slice(o).join(" ")];r+=" "+s}return[e]},getNodeTextDY:function(e,t){return 1>=t?5:-3},getNodeTitleKey:function(){return"name"},getNodeText:function(e){return e._properties[this.getNodeTitleKey()]},drawNodeTexts:function(e){var t=this,n=e.append("text").attr("text-anchor","middle");n.each(function(e){t.drawNodeText.apply(t,[this,e])})},drawNodeText:function(e,t){var s=this.getNodeText(t),r=[],i=n.select(e);if(s){i.text(""),r=this.splitNodeText(s),i.attr("dy",this.getNodeTextDY(t,r.length));for(var a=0;a<r.length;a++){var o=i.append("tspan").text(r[a]);a>0&&o.attr("x",0).attr("dy",20)}}},setNodeText:function(e,n){var s=t("text",e).get(0);this.drawNodeText(s,n)},getVisibleLinks:function(){return this.edges},redrawLinks:function(){n.select(this.selector+" .links").selectAll(".link").remove(),this.drawLinks()},drawLinks:function(){var e=this.getVisibleLinks(),t=n.select(this.selector+" .links").selectAll(".link").data(e,function(e){return e.source.index+"#"+e.target.index+"#"+e.type}),s=t.enter().append("polyline");return this.drawLinkExit(t.exit()),this.drawLinkEnter(s),this.link=t,this},drawLinkEnter:function(e){e.attr("class",function(e){return i.getLinkClassValue(e)})},drawLinkExit:function(e){e.remove()},getNodeFromData:function(e){return e?n.selectAll(".node").filter(function(t){return t.index==e.index}).node():null},resolveNode:function(e,t){return e?e:this.getNodeFromData(t)},getDataFromNode:function(e){return e?n.select(e).datum():null},resolveData:function(e,t){return t?t:this.getDataFromNode(e)},handleMouseOver:function(e,t){e.hoveredNode={data:t,node:this}},handleMouseOut:function(e){e.hoveredNode=null},handleMouseClick:function(e,s){n.event.defaultPrevented||t(e.kernel).trigger("node-clicked",[this,s])},handleMouseDown:function(e,n){t(e.kernel).trigger("mouse-down",[this,n])},handleMouseUp:function(e){t(e.kernel).trigger("mouse-up")},updateDragData:function(e,t){var n,s;this.draggedNode&&(this.xChange=this.xChange+e,this.yChange=this.yChange+t,n=Math.abs(this.xChange),s=Math.abs(this.yChange),this.dragDistance=Math.sqrt(Math.pow(n,2)+Math.pow(s,2)),this.xChange>0&&n>s?this.dragDirection=l.RIGHT:this.xChange<0&&n>s?this.dragDirection=l.LEFT:this.yChange>0&&s>n?this.dragDirection=l.DOWN:this.yChange<0&&s>n&&(this.dragDirection=l.UP))},handleNodeDrag:function(e,s){e.updateDragData(n.event.dx,n.event.dy),t(e.kernel).trigger(n.event,[this,s]),0==e.dragDistance||e.holding||(e.dragging=!0,this.style.pointerEvents="none",s.px+=n.event.dx,s.py+=n.event.dy,s.x+=n.event.dx,s.y+=n.event.dy,e.handleTick())},handleNodeDragStart:function(e,s){console.log("node drag start"),console.log(e),console.log(this),t(e.kernel).trigger(u.START,[this,s]),n.event.sourceEvent.stopPropagation(),e.xChange=0,e.yChange=0,e.draggedNode={data:s,node:this},e.force.stop()},handleNodeDragEnd:function(e,n){t(e.kernel).trigger(u.END,[this,n]),0!==e.dragDistance&&e.force.resume(),e.draggedNode.node.style.pointerEvents="auto",e.draggedNode=null,e.dragging=!1,e.dragDistance=0},handleWindowResize:function(){var n=t(e).width(),s=t(e).height();t(this.selector).attr("width",n).attr("height",s)},handleTick:function(){var e=this.link,t=this.node;t.attr("transform",function(e){var t="translate(__x__, __y__)",n=1e4,s=1e4,r=2*i.getNodeRadius(e),a={x:Math.max(r,Math.min(n-r,e.x)),y:Math.max(r,Math.min(s-r,e.y))};return e.x=a.x,e.y=a.y,t.replace(/__x__/g,a.x).replace(/__y__/g,a.y)}),e&&e.attr("points",function(e){return e.source.x+","+e.source.y+" "+(e.source.x+e.target.x)/2+","+(e.source.y+e.target.y)/2+" "+e.target.x+","+e.target.y})}})}(this,s,n,t),function(e,t,n,s){"use strict";{var r=(e.setNamespace("app.graph"),e.setNamespace("app.graph.graphics"));e.use("app.constants.NodeStatus")}r.scaleNode=function(e,t,r){var i=r.resolveData(t,s),a=i._shape.scale,o=a.x*e,h=a.y*e;n.select(t).selectAll(".top-circle").transition().duration(500).attr("d",i._shape.path).attr("transform","scale("+o+","+h+")")},r.classNode=function(e,t,s,r){s=n.select(s),console.log("classing node"),console.log(r.index),console.log(s),console.log(s.datum()),s.classed(e,t)},r.handleNodeScale=function(e,t,n){r.scaleNode(e,n,this.graph)},r.handleClassNode=function(e,t,n,s){r.classNode(e,!0,n,s,this.graph)},r.handleUnclassNode=function(e,t,n,s){r.classNode(e,!1,n,s,this.graph)},r.handleNodeColor=function(e,t,s){r.colorNodes(n.select(s),e,500)},r.colorNodes=function(e,t,n){e.selectAll(".top-circle").transition().duration(n).style("fill",t)},r.classNodes=function(e,t){e.each(function(e){n.select(this).classed(t(e))})},r.shapeNodes=function(e,t){var s;e.each(function(e){s=t(e),n.select(this).selectAll(".top-circle").transition().duration(500).attr("d",s.path).attr("transform","scale("+s.scale.x+","+s.scale.y+")")})}}(this,s,n),function(e,t,n){"use strict";var s=e.setNamespace("app.modules"),r=e.use("app"),i=e.use("app.model.Node"),a=e.use("app.graph.graphics"),o=e.use("app.constants.EvaluationStrategy"),h={strategy:o.PROPERTY,labels:{},labelPriority:[],properties:{},propertyPriority:[]};s.Classable=r.createClass({construct:function(e){this.options=t.extend({},h,e)},classNodeByProperty:function(e){var t,n,s,r,i,a=this.options.properties,o={};for(n in a){r=e._properties[n],s=a[n];for(i in s)s.hasOwnProperty(i)&&(t=s[i],o[t]=i===r?!0:!1)}return o},handleClassNodes:function(e,t,s,r){var h=this.options.strategy;if(r){if(!r.changed(i.getPropertiesPath())&&!r.changed(i.getLabelsPath()))return;t=n.select(t)}h===o.PROPERTY&&a.classNodes(t,this.classNodeByProperty.bind(this))}})}(this,s,n),function(e,t,n){"use strict";var s=e.setNamespace("app.modules"),r=e.use("app"),i=e.use("app.graph.graphics"),a=e.use("app.constants.EvaluationStrategy"),o={numColors:10,strategy:a.PROPERTY,defaultValue:"#d2d2d2",labels:{},labelPriority:[],properties:{},propertyPriority:[]};s.Colorable=r.createClass({construct:function(e){this.colorMap={},this.colorCount=0,this.colors=n.scale.category10(),this.options=t.extend({},o,e)},colorNodeByLabel:function(e){var t,n,s=this.options.defaultColor,r=this.options.labels;return e._labels&&e._labels.length>0&&(n=e._labels[0],this.colorMap.hasOwnProperty(n)||(r.hasOwnProperty(n)?this.colorMap[n]=r[n]:(t=this.colorCount%this.options.numColors,this.colorMap[n]=this.colors(t),this.colorCount++)),s=this.colorMap[n]),s},colorNodeByProperty:function(e){var t,n,s,r,i=this.options.defaultColor,a=this.options.properties,o=this.options.propertyPriority,h=0!==o.length,l=-1;for(t in a)e.hasOwnProperty(t)&&(r=e[t],s=a[t],s.hasOwnProperty(r)&&(n=o.indexOf(t),h&&-1!==n&&l>n?(i=s[r],l=n):-1===l&&(i=s[r])));return i},handleColorNodes:function(e,t,s,r){var o=this.options.strategy,h=0;if(r){if(!r.changed(Node.getPropertiesPath())&&!r.changed(Node.getLabelsPath()))return;t=n.select(t),h=500}o===a.PROPERTY?i.colorNodes(t,this.colorNodeByProperty.bind(this),h):i.colorNodes(t,this.colorNodeByLabel.bind(this),h)}})}(this,s,n),function(e,t){"use strict";var n,s=(e.setNamespace("app.graph"),e.setNamespace("app.modules")),r=e.use("app"),i=e.use("app.event.EdgeEvent");s.EdgeCRUD=r.createClass({construct:function(e){this.options=t.extend({},n,e)},initialize:function(){t(this.kernel).on(i.CREATE,this.handleCreateEdge.bind(this)).on(i.DESTROY,this.handleDestroyEdge.bind(this))},handleLinking:function(){console.log("handling linking"),this.graph.dragging&&this.graph.draggedNode&&this.graph.hoveredNode&&this.updateLink(this.graph.draggedNode.data,this.graph.hoveredNode.data)},handleCreateEdge:function(e,t,n,s){console.log("handling edge creation"),this.updateLink(t,n,s,2)},handleDestroyEdge:function(e,t,n,s){console.log("handling edge deletion"),this.updateLink(t,n,s,1)},handleUpdateEdge:function(){},resolveEdgeType:function(e,t,n){return n?n:"POINTS_TO"},indexOfEdge:function(e,t,n){var s=-1;return this.graph.edges.forEach(function(r,i){return n&&r.type!==n?s:void((r.source.index==e.index&&r.target.index==t.index||r.source.index==t.index&&r.target.index==e.index)&&(s=i))}),s},create:function(e){return e.hasOwnProperty("source")&&e.hasOwnProperty("target")&&e.hasOwnProperty("type")?(this.graph.edges.push(e),void t(this.kernel).trigger(i.CREATED,[e,source,target])):null},replace:function(e,n){var s=this.graph.edges[e];this.graph.edges[e]=n,t(this.kernel).trigger(i.REPLACED,[n,s])},updateLink:function(e,n,s,r){var a,o=this.indexOfEdge(e,n,s);s=this.resolveEdgeType(e,n,s),e.index!=n.index&&(r||(r=-1===o?2:1),-1===o&&2===r?(a={source:e,target:n,type:s},this.graph.edges.push(a),t(this.kernel).trigger(i.CREATED,[a,e,n])):o>=0&&1===r&&(a=this.graph.edges[o],this.graph.edges.splice(o,1),t(this.kernel).trigger(i.DESTROYED,[a])),this.graph.drawLinks(),this.graph.force.start())}})}(this,s,n),function(e,t,n,s){"use strict";var r=e.setNamespace("app.modules"),i=e.use("app"),a=e.use("app.model.Node"),o=(e.use("app.graph.graphics"),e.use("app.constants.EvaluationStrategy")),h={strategy:o.LABEL,labels:{},labelPriority:[],properties:{},propertyPriority:[]};r.Evaluable=i.createClass({construct:function(e){this.options=t.extend({},h,e)},evaluateLabels:function(e){var t,n,s=this.options.defaultValue,r=this.options.labels,i=this.options.labelPriority,o=0!==i.length,h=-1;if(!s)throw"Default value not specified";for(t in r)a.hasLabel(e,t)&&(n=i.indexOf(t),o&&-1!==n&&h>n?(s=r[t],h=n):-1===h&&(s=r[t]));return s},evaluateProperties:function(e){var t,n,r,i,o=this.options.defaultValue,h=this.options.properties,l=this.options.propertyPriority,d=0!==l.length,u=-1;if(!o)throw"Default value not specified";for(t in h)r=a.getPropertyValue(e,t),r!==s&&(n=h[t],n.hasOwnProperty(r)&&(i=l.indexOf(t),d&&-1!==i&&u>i?(o=n[r],u=i):-1===u&&(o=n[r])));return o}})}(this,s,n),function(e,t,n,s){"use strict";var r=e.setNamespace("app.modules"),i=e.use("app");r.Filterable=i.createClass({initialize:function(){},drawNodeOverlay:function(e){var t=this;e.append("svg:circle").attr("class","overlay").attr("r",function(){var e=2*t.graph.getNodeRadius();return e})},filter:function(e){var t=[];return n.selectAll(".node").classed("filtered",function(n){var s,r,i;i=new RegExp(e,"i");for(s in n._properties)if(n._properties.hasOwnProperty(s)&&(r=String(n._properties[s]),r.match(i)))return t.push(n),!1;return!0}),t},resetFilter:function(){n.selectAll(".filtered").classed("filtered",!1)},handleNodeDrawn:function(e,t){this.drawNodeOverlay(t)},handleNodeFilter:function(e,n){var r=this.filter(n);t(this.kernel).trigger("node-filtered",[s,r])},handleNodeFilterUnset:function(){this.resetFilter()}})}(this,s,n),function(e,t,n){"use strict";var s=e.setNamespace("app.modules"),r=e.use("app"),i=e.use("app.model.Node"),a=e.use("app.graph.graphics"),o=e.use("app.constants.EvaluationStrategy"),h={strategy:o.PROPERTY,defaultValue:!0,labels:{},labelPriority:[],properties:{},propertyPriority:[]};s.Hidable=r.createClass(s.Evaluable,{construct:function(e){this.options=t.extend({},h,e),this.baseOptions=t.extend({},h,e),this.filter={}},initialize:function(){t(this.kernel).on("graph-mode-changed",this.handleHideNodes.bind(this))},hideNodeByLabel:function(e){var t=this.evaluateLabels(e);return t},hideNodeByProperty:function(e){var t=this.evaluateProperties(e);return t},handleHideNodes:function(e,t,s,r){{var h=this.options.strategy;this.graph}if(r){if(!r.changed(i.getPropertiesPath())&&!r.changed(i.getLabelsPath()))return;t=n.select(t)}h===o.PROPERTY?(console.log("shaping by property"),a.shapeNodes(t,this.shapeNodeByProperty.bind(this))):a.shapeNodes(t,this.shapeNodeByLabel.bind(this))}})}(this,s,n),function(e,t){"use strict";var n,s=e.setNamespace("app.modules"),r=e.use("app"),i=e.use("app.constants.Drag"),a=e.use("app.event.HoldEvent"),o={duration:500};s.Holdable=r.createClass({construct:function(e){n=this,this.options=t.extend({},o,e)},initialize:function(){this.graph.holdActions={},this.graph.holdActions[i.LEFT]="None",this.graph.holdActions[i.RIGHT]="None",this.graph.holdActions[i.UP]="None",this.graph.holdActions[i.DOWN]="None"},handleHoldStart:function(e,s,r,i){var o=this.graph;this.holdTimeoutId=window.setTimeout(function(){o.dragging||(console.log("holding"),o.holding=!0,s?t(n.kernel).trigger(a.NODE,[s,r]):(t(n.kernel).trigger(a.CANVAS,[{},i]),o.holding=!1))},this.options.duration)},handleHoldDrag:function(e){var t;this.graph.holding&&(e.sourceEvent.preventDefault(),t=this.graph.dragDistance>100?this.graph.holdActions[this.graph.dragDirection]:"Too close")},handleHoldEnd:function(e,n,s){if(window.clearTimeout(this.holdTimeoutId),n){if(this.graph.holding&&this.graph.dragDistance>100)switch(this.graph.dragDirection){case i.LEFT:t(this.kernel).trigger(a.DRAGLEFT,[n,s]);break;case i.RIGHT:t(this.kernel).trigger(a.DRAGRIGHT,[n,s]);break;case i.UP:t(this.kernel).trigger(a.DRAGUP,[n,s]);break;case i.DOWN:t(this.kernel).trigger(a.DRAGDOWN,[n,s])}this.graph.dragging=!1,this.graph.holding=!1}}})}(this,s,n),function(e,t){"use strict";var n=e.setNamespace("app.modules"),s=e.use("app"),r=e.use("app.model.Node"),i={link:["link"]};n.Hyperlinkable=s.createClass({construct:function(e){this.options=t.extend({},i,e)},checkURI:function(){return!0},followLink:function(e){window.open(e)},handleFollowLink:function(e,t,n){var s,i,a,o=this.options.link,h=[];for(a=0;a<o.length;a++)s=o[a],i=r.getPropertyValue(n,s),i&&this.checkURI(i)&&h.push(i);h.length>0?this.followLink(h[0]):console.log("no links")}})}(this,s,n),function(e,t){"use strict";var n=e.setNamespace("app.modules"),s=(e.setNamespace("app.transformer"),e.use("app")),r=(e.use("app.model"),e.use("app.model.Node2")),i=e.use("app.event.NodeEvent"),a=e.use("app.event.EdgeEvent"),o={properties:{},labels:[]};n.NodeCRUD=s.createClass({construct:function(e){this.options=t.extend({},o,e)},initialize:function(){t(this.kernel).on(i.CREATE,this.handleNodeCreate.bind(this)).on(i.UPDATE,this.handleUpdate.bind(this)).on(i.DESTROY,this.handleNodeDestroy.bind(this))},createNode:function(e,n,s,a){console.log("creating node, x: "+s+", y: "+a);var o,h,l,d,u=this.options.properties,c=this.options.labels;for(o in u)u.hasOwnProperty(o)&&(e.hasOwnProperty(o)||(e[o]=u[o]));for(d=0;d<c.length;d++)h=c[d],-1===n.indexOf(h)&&n.push(h);return l=new r(null,e,null,n),l.x=s||0,l.y=a||0,this.graph.nodes.push(l),this.graph.drawNodes(),this.graph.handleTick(),this.graph.force.start(),t(this.kernel).trigger(i.CREATED,[null,l]),l},deleteEdgesForNode:function(e){for(var t,n=this.graph.edges,s=n.length-1;s>=0;s--)t=n[s],(t.source.index==e||t.target.index==e)&&n.splice(s,1)},destroyNode:function(e){if(confirm("destroy node?")){var n=this.graph;this.deleteEdgesForNode(e.index),n.nodes.splice(e.index,1),n.drawLinks(),n.redrawNodes(),n.force.start(),t(this.kernel).trigger(i.DESTROYED,[e])}},updateNode:function(e,n,s){e=this.graph.resolveNode(e,n),n=this.graph.resolveData(e,n),s.process(n),s.count&&(this.graph.setNodeText(e,n),t(this.kernel).trigger(i.UPDATED,[e,n,s]))},handleCreateChildNode:function(e,n,s){var r=this.createNode({},[],s.x,s.y);t(this.kernel).trigger(a.CREATE,[s,r]).trigger(i.SELECT,[null,r])},handleNodeCreate:function(e,t,n){var s;e.preventDefault(),e.stopPropagation(),n||(n={x:0,y:0}),s=this.createNode(t,[],n.x,n.y)},handleUpdate:function(e,t,n,s){return e.preventDefault(),e.stopPropagation(),console.log("handling node update"),s?void this.updateNode(t,n,s):void console.log("no update passed")},handleNodeDestroy:function(e,t,n){this.destroyNode(n)}})}(this,s,n,t),function(e,t){"use strict";
var n=e.setNamespace("app.modules"),s=e.use("app");n.Pinnable=s.createClass({handleNodePinned:function(e,n,s){s.fixed=!s.fixed,t(this.kernel).trigger("node-pinned",[n,s])}})}(this,s),function(e,t){"use strict";var n=e.setNamespace("app.modules"),s=e.use("app"),r=e.use("app.event.NodeEvent");n.Selectable=s.createClass({construct:function(){this.selectedNode=null},initialize:function(){t(this.kernel).on(r.SELECT,this.handleNodeSelect.bind(this)).on(r.UNSELECT,this.handleNodeUnselect.bind(this))},handleNodeSelect:function(e,n,s){console.log("selecting"),console.log(s),console.log(n);var i=this.selectedNode;if(i){if(i.data.index==s.index)return;t(this.kernel).trigger(r.UNSELECT,[i.node,i.data])}n=this.graph.resolveNode(n,s),s=this.graph.resolveData(n,s),this.selectedNode={node:n,data:s},t(this.kernel).trigger(r.SELECTED,[n,s])},handleNodeUnselect:function(e,n,s){var i=this.selectedNode;s?t(this.kernel).trigger(r.UNSELECTED,[n,s]):i&&t(this.kernel).trigger(r.UNSELECTED,[i.node,i.data]),i&&(this.selectedNode=null)}})}(this,s,n),function(e,t,n){"use strict";var s=e.setNamespace("app.modules"),r=e.use("app"),i=e.use("app.model.Node"),a=e.use("app.graph.graphics"),o=e.use("app.constants.EvaluationStrategy"),h={strategy:o.PROPERTY,defaultValue:"circle",directMapping:!0,paths:{},shapes:{},labels:{},labelPriority:[],properties:{},propertyPriority:[]};s.Shapable=r.createClass(s.Evaluable,{construct:function(e){this.options=t.extend({},h,e)},getShapeObject:function(e,t){var s,r,i,a,o=this.options.shapes,h=this.options.paths;return o.hasOwnProperty(e)?(s=o[e],r=s[0],a={x:s[1],y:s[2]}):(r=e,a={x:1,y:1}),i=h.hasOwnProperty(r)?h[r]:n.superformula().type(r).size(t).segments(50),{shape:e,path:i,scale:a}},getSizeFromRadius:function(e){return Math.pow(3*e,2)},shapeNodeByLabel:function(e){var t,n;return t=this.evaluateLabels(e),n=this.getSizeFromRadius(this.graph.getNodeRadius(e)),e._shape=this.getShapeObject(t,n),e._shape},shapeNodeByProperty:function(e){var t,n;return t=this.evaluateProperties(e),n=this.getSizeFromRadius(this.graph.getNodeRadius(e)),e._shape=this.getShapeObject(t,n),e._shape},handleShapeNodes:function(e,t,s,r){{var h=this.options.strategy;this.graph}if(r){if(!r.changed(i.getPropertiesPath())&&!r.changed(i.getLabelsPath()))return;t=n.select(t)}h===o.PROPERTY?a.shapeNodes(t,this.shapeNodeByProperty.bind(this)):a.shapeNodes(t,this.shapeNodeByLabel.bind(this))}})}(this,s,n),function(e,t){"use strict";var n=e.setNamespace("app.modules"),s=e.use("app"),r=e.use("app.model"),i=e.use("app.event.NodeEvent"),a={path:"_style",storables:{}};n.Storable=s.createClass({construct:function(e){this.options=t.extend({},a,e)},initialize:function(){t(this.kernel).on(i.LOADED,this.handleGraphLoaded.bind(this))},objectToString:function(e){return JSON.stringify(e)},objectFromString:function(e){return JSON.parse(e)},getStorableString:function(t,n){var s,r,i,a,o,h,l,d=this.options.storables,u={};for(s in d){for(l={},r=d[s],i=0;i<r.length;i++)a=r[i],o=e.getObjectValueByPath(n,a),l[a]=o;u[s]=l}return h=this.objectToString(u)},parseStorableString:function(t){var n,s,r,i,a=this.options.storables,o=this.options.path;if(t.hasOwnProperty(o)){s=this.objectFromString(t[o]);for(n in s)if(a.hasOwnProperty(n)){r=s[n];for(i in r)e.setByPath(t,i,r[i])}}},handleGraphLoaded:function(e,t){var n,s;for(n=0;n<t.length;n++)s=t[n],this.parseStorableString(s)},handleNodeStyled:function(e,n,s){if(s.fixed){var a=this.getStorableString(n,s),o=new r.Update;o.set(this.options.path,a),t(this.kernel).trigger(i.UPDATE,[n,s,o])}}})}(this,s,n),function(e,t){"use strict";var n,s=e.setNamespace("app.modules"),r=e.use("app"),i=e.use("app.model"),a=e.use("app.event.NodeEvent"),o=e.use("app.constants.NodeStatus");s.Validatable=r.createClass({construct:function(e){this.options=t.extend({},n,e)},setNodeStatus:function(e,n,s){var r;n._properties.hasOwnProperty("status")&&n._properties.status===s||(r=new i.Update,r.setProperty("status",s),t(this.kernel).trigger(a.UPDATE,[e,n,r]))},handleDenyNode:function(e,t,n){this.setNodeStatus(t,n,o.DENIED)},handleAcceptNode:function(e,t,n){this.setNodeStatus(t,n,o.ACCEPTED)}})}(this,s,t),function(e,t,n,s){"use strict";var r,i=e.setNamespace("app.modules"),a=e.use("app");i.Zoomable=a.createClass({construct:function(e){this.options=t.extend({},r,e)},initialize:function(){var e=s.bind(this.handleZoom,this),r=s.bind(this.handleZoomStart,this),i=s.bind(this.handleZoomEnd,this);n.select(this.graph.selector+" .graph-viewport").call(n.behavior.zoom().on("zoom",e).on("zoomstart",r).on("zoomend",i)),this.options.doubleclick||n.select(this.graph.selector+" .graph-viewport").on("dblclick.zoom",null),this.elem=t(".graph-content",this.graph.selector).get(0)},handleZoom:function(){var e=n.mouse(this.elem),t=this.dragStartPosition[0]-e[0],s=this.dragStartPosition[1]-e[1];(0!=t||0!=s)&&(this.graph.dragging=!0);var r="translate(__translate__) scale(__scale__)",i=r.replace(/__translate__/g,n.event.translate).replace(/__scale__/g,n.event.scale);n.select(this.graph.selector).select(".graph-content").attr("transform",i)},handleZoomStart:function(){this.dragStartPosition=n.mouse(this.elem)},handleZoomEnd:function(){this.graph.dragging=!1}})}(this,s,n,t),function(e,t){"use strict";var n=e.setNamespace("app.transformer"),s=e.use("app"),r={map:{}};n.AbstractDataTransformer=s.createClass({construct:function(e){this.options=t.extend({},r,e)},from:function(){throw'The data transformer should implement a "from" function'},to:function(){throw'The data transformer should implement a "to" function'},getMappedProperties:function(e){return this.filterAndChangePropertyKeys(e,this.options.map)},filterAndChangePropertyKeys:function(e,t){var n,s,r,i={};for(s in t)t.hasOwnProperty(s)&&(n=t[s],r=e[n],r&&(i[s]=r));return i},mapProperties:function(e,n){var s={};return t.forOwn(e,function(e,t){n.hasOwnProperty(t)&&n[t]&&(s[n[t]]=e)}),s},splitProperties:function(e,n){var s={},r={};return t.forOwn(e,function(e,t){n.hasOwnProperty(t)?n[t]&&(r[n[t]]=e):s[t]=e}),{properties:s,mapped:r}}})}(this,t),function(e){"use strict";var t=e.setNamespace("app.transformer"),n=e.use("app");t.D3Transformer=n.createClass(t.AbstractDataTransformer,{from:function(e){return e},to:function(e){return e}})}(this),this.app}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);