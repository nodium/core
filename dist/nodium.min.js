!function e(t,n,s){function i(a,o){if(!n[a]){if(!t[a]){var h="function"==typeof require&&require;if(!o&&h)return h(a,!0);if(r)return r(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return i(n?n:e)},l,l.exports,e,t,n,s)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<s.length;a++)i(s[a]);return i}({1:[function(e){!function(t){t.Nodium=e("./nodium")}(window)},{"./nodium":2}],2:[function(e,t){(function(n){t.exports=function(){var t="undefined"!=typeof window?window._:"undefined"!=typeof n?n._:null,s="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,i="undefined"!=typeof window?window.$:"undefined"!=typeof n?n.$:null;return this.app={context:{_:t,d3:s,jQuery:i}},function(e){e.setNamespace=function(t){var n,s,i,r=t.split("."),a=e;for(s=0,i=r.length;i>s;s++)n=r[s],a[n]=a[n]||{},a=a[n];return a}}(this),function(e){e.use=function(t){for(var n,s=t.split("."),i=e;n=s.shift();)i=i[n]||{};return i}}(this),function(e){var t=e.setNamespace("app");t.clearTimeout=e.clearTimeout.bind(e),t.setTimeout=e.setTimeout.bind(e),t.open=e.open.bind(e)}(this),function(e){var t=e.setNamespace("app.util");t["super"]=function(e){var e,t,n=Object.getPrototypeOf(Object.getPrototypeOf(this));return t=[].slice.call(arguments,1),n.hasOwnProperty(e)?n[e].apply(this,t):void 0}}(this),function(e){var t=(e.setNamespace("app.util"),e.use("app")),n=e.use("app.util.super"),s=!1;t.createClass=function(){var e,t,i,r,a,o;if(o=[].slice.call(arguments,0),"function"==typeof o[0]&&(t=o.shift()),r=o.shift(),e=function(){if(!1==this instanceof e)return new e(arguments);if(Object.getPrototypeOf(this).hasOwnProperty("construct")||(s=!0),this.construct&&"function"==typeof this.construct){var t=[].slice.call(arguments,0);t.unshift("construct"),this["super"].apply(this,t),s||this.construct.apply(this,t.slice(1))}s=!1},null!=t){s=!0,i=new t;for(a in r)r.hasOwnProperty(a)&&(i[a]=r[a])}else r["super"]=n;return e.prototype=i||r,e}}(this),function(e){function t(e,t){var s=e.data("prototype");return n.stringFromTemplate(s,t)}var n=e.setNamespace("app.util");n.createFromPrototype=t}(this),function(e){e.getFunction=function(t){for(var n,s=t.split("."),i=e;n=s.shift();){if(!i[n])return null;i=i[n]}return"function"==typeof i?i:null}}(this),function(e){e.getObjectValueByPath=function(t,n){for(var s,i=e.getPathArray(n);i.length;){if(s=i.shift(),!(s in t))return;t=t[s]}return t}}(this),function(e){e.getPathArray=function(e){var t;return"string"==typeof e?(e=e.replace(/\[(\w+)\]/g,".$1"),e=e.replace(/^\./,""),t=e.split(".")):t=e,t}}(this),function(e){e.partial=function(t,n){var s,i=Array.prototype.slice,r=Array.prototype.concat;return s=n?i.call(arguments,2):i.call(arguments,1),s=r.apply([],s),n=n||e,function(){return t.apply(n,s.concat(i.call(arguments)))}}}(this),function(e,t){e.removeByPath=function(n,s,i){for(var r,a=e.getPathArray(s),o=i===t?a.length-1:a.length;o;o--){if(r=a.shift(),!(r in n))return!1;n=n[r]}if(i===t)return r=a.shift(),Array.isArray(n)?(r=parseInt(r,10),isNaN(r)?!1:(n.splice(r,1),!0)):"object"==typeof n?(delete n[r],!0):!1;if(Array.isArray(n))return r=n.indexOf(i),-1===r?!1:(n.splice(r,1),!0);throw"object"==typeof n?"Cannot remove value from object":"Cannot remove value from this type"}}(this),function(e){e.setByPath=function(t,n,s){for(var i,r=e.getPathArray(n),a=!1;r.length-1;)i=r.shift(),i in t||(a=!0,t[i]={}),t=t[i];if(i=r.shift(),i in t||(a=!0),Array.isArray(t)){if(i=parseInt(i,10),isNaN(i))return!1;-1===i?t.push(s):t.splice(i,0,s)}else{if("object"!=typeof t)throw"Cannot remove value from this type";t[i]=s}return a}}(this),function(e,t){function n(e,n){return t.reduce(n,s,e)}function s(e,t,n){return e.replace(new RegExp("{"+n+"}"),t)}var i=e.setNamespace("app.util");i.stringFromTemplate=n}(this,t),function(e){var t=e.setNamespace("app.util");t.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}}(this),function(e,t){var n=e.setNamespace("app.event"),s=e.use("app"),i=function(e){return e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})};n.EventAware=s.createClass({construct:function(){this.events=[]},destroy:function(){var e;for(e=this.events.length;e>0;e--)this.off.apply(this,this.events[e-1])},off:function(){var e,t,n=Array.prototype.slice.call(arguments,0);return n.length>1&&(e=n.shift()),t=this.resolveSelector(),t.off.apply(t,n),index=this.events.indexOf(n),-1!==index&&(this.events=this.events.splice(index,1)),this},on:function(e){var t,n,s,i=Array.prototype.slice.call(arguments,1);return i.length>1&&(n=i.shift()),t=i[0],i.push(this.resolveEvent(t,e)),s=this.resolveSelector(n),s.on.apply(s,i),this.events.push(i.unshift(n)),this},resolveEvent:function(e,t){var n,s=i(["handle",e].join("-"));if(n=t[s],n&&"function"==typeof n)return n.bind(t);throw new Error("Could not resolve "+e+" to function.")},resolveSelector:function(){return t(this)}})}(this,i),function(e,t){"use strict";var n=e.setNamespace("app.api"),s=e.use("app"),i=e.use("app.model"),r=e.use("app.event.NodeEvent"),a=e.use("app.event.EdgeEvent");n.APIConsumer=s.createClass({construct:function(e){this.api=e},initialize:function(){t(this.kernel).on(r.CREATED,this.handleNodeCreated.bind(this)),t(this.kernel).on(r.DESTROYED,this.handleNodeDeleted.bind(this)),t(this.kernel).on(a.CREATED,this.handleEdgeCreated.bind(this)),t(this.kernel).on(a.DESTROYED,this.handleEdgeDeleted.bind(this)),t(this.kernel).on(r.UPDATED,this.handleNodeUpdated.bind(this)),t(this.kernel).on(r.UPDATED,this.handleNodeLabelUpdated.bind(this))},get:function(e){this.api.getGraph().then(e)},handleNodeCreated:function(e,t,n){this.api.createNode(n)},handleNodeDeleted:function(e,t){this.api.deleteNode(t)},handleEdgeCreated:function(e,t,n,s){this.api.createEdge({from:n,to:s}).then(function(e){t._id=e})},handleEdgeDeleted:function(e,t){this.api.deleteEdge({id:t.id})},handleNodeUpdated:function(e,t,n,s){(s.changed(i.Node.getPropertiesPath())||s.changed("_style"))&&(console.log("api: handling node update"),console.log(n._id),this.api.updateNode(n))},handleNodeLabelUpdated:function(e,t,n,s){s.changed(i.Node.getLabelsPath())&&(console.log("api: handling node label update"),console.log(n._id),this.api.updateNodeLabels(n))}})}(this,i),function(e){var t=e.setNamespace("app.constants");const n={LEFT:1,RIGHT:2,UP:3,DOWN:4};t.Drag=n}(this),function(e){"use strict";var t=e.setNamespace("app.constants");t.EvaluationStrategy={LABEL:"label",PROPERTY:"property"}}(this),function(e){var t=e.setNamespace("app.constants");const n={ACCEPTED:"accepted",DENIED:"denied",PENDING:"pending"};t.NodeStatus=n}(this),function(e){var t,n=e.setNamespace("app.event");t={START:"drag-start",DRAG:"drag",END:"drag-end"},n.DragEvent=t}(this),function(e){var t,n=e.setNamespace("app.event");t={CREATE:"edge-create",REPLACE:"edge-replace",UPDATE:"edge-update",DESTROY:"edge-delete",SELECT:"edge-select",UNSELECT:"edge-unselect",CREATED:"edge-created",REPLACED:"edge-replaced",UPDATED:"edge-updated",DESTROYED:"edge-destroyed",SELECTED:"edge-selected",UNSELECTED:"edge-unselected",DRAWN:"edge-drawn",MODECHANGE:"edge-mode-change",MODECHANGED:"edge-mode-change"},n.EdgeEvent=t}(this),function(e){var t=e.setNamespace("app.event");const n={CHANGE:"change",CLICK:"click",FOCUS_OUT:"focusout",INPUT:"input",KEY_DOWN:"keydown",KEY_UP:"keyup",MOUSE_DOWN:"mousedown",MOUSE_DRAG:"mousedrag",MOUSE_MOVE:"mousemove",MOUSE_UP:"mouseup",PASTE:"paste",POP_STATE:"popstate",SCROLL:"scroll",SUBMIT:"submit"};t.Event=n}(this),function(e){var t,n=e.setNamespace("app.event");t={NODE:"holding-node",CANVAS:"holding-canvas",DRAGDOWN:"hold-drag-down",DRAGUP:"hold-drag-up",DRAGLEFT:"hold-drag-left",DRAGRIGHT:"hold-drag-right"},n.HoldEvent=t}(this),function(e,t){"use strict";var n=e.setNamespace("app.event"),s=e.use("app.event.EventAware"),i=e.use("app");n.Kernel=i.createClass(s,{register:function(e,t){return e.kernel=this,t&&this.attachModuleEvents(e,t),"function"==typeof e.initialize&&e.initialize(),this},attachModuleEvents:function(n,s){for(var i,r,a,o,h=[],d=0;d<s.length;d++)i=s[d],r=i[0],r&&(a=i.slice(1),h=a.slice(1),a=a[0],a&&(o=n[a]&&"function"==typeof n[a]?n[a]:e.getFunction(a),o&&t(this).on(r,e.partial(o,n,h))))}})}(this,i,s,t),function(e){var t=e.setNamespace("app.event");const n={ESCAPE:"key-escape"};t.KeyboardEvent=n}(this),function(e){var t=e.setNamespace("app.event");const n={CREATE:"node-create",UPDATE:"node-update",UPDATEPROPERTY:"node-update-property",UPDATELABEL:"node-update-label",DESTROY:"node-delete",SELECT:"node-select",UNSELECT:"node-unselect",CREATED:"node-created",UPDATED:"node-updated",UPDATEDPROPERTY:"node-updated-property",UPDATEDLABEL:"node-updated-label",DESTROYED:"node-destroyed",SELECTED:"node-selected",UNSELECTED:"node-unselected",FILTER:"node-filter",FILTERED:"node-filtered",FILTER_UNSET:"node-filter-unset",DRAWN:"node-drawn",LOADED:"graph-loaded"};t.NodeEvent=n}(this),function(e,t,n,s,i){"use strict";{var r,a=e.setNamespace("app.graph"),o=e.use("app.event"),h=e.use("app"),d=e.use("app.constants.Drag"),l=e.use("app.event.NodeEvent"),c=e.use("app.event.DragEvent");e.use("app.event.HoldEvent")}a.Graph=h.createClass({construct:function(e,t){this.selector=e,this.kernel=t||new o.Kernel,this.draggedNode=null,this.dragging=!1,this.dragDirection=0,this.hoveredNode=null,this.visibleNodes=null,this.visibleEdges=null,this.options={shapes:{generator:"symbol"}},r=this},register:function(e,t){return e.graph=this,this.kernel.register(e,t),this},getGraphData:function(){var e=t(this.selector).data("graph");t(this.selector).attr("data-graph",null),this.handleGraphData(e)},handleGraphData:function(e){var n;this.nodes=e.nodes||[],this.edges=e.edges||[],this.force=this.createForce(),this.force.start(),this.drawLinks(),this.drawNodes(),n=s.bind(this.handleTick,this),this.force.on("tick",n),this.handleWindowResize(),t(this.kernel).trigger(l.LOADED,[this.nodes,this.edges])},createForce:function(){var e;return e=n.layout.force().charge(-2500).linkDistance(function(e){return r.getLinkDistance(e)}).size([1e4,1e4]).nodes(this.nodes).links(this.edges).linkStrength(function(){return 1})},initialize:function(){var n=s.bind(this.handleWindowResize,this);t(e).on("resize",n),this.initializeViewport(),this.getGraphData()},initializeViewport:function(){n.select(this.selector+" .graph-viewport").attr("transform",function(){var e=.2,t="-220, -700",n="translate(__translate__) scale(__scale__)",s=n.replace(/__translate__/g,t).replace(/__scale__/g,e);return s})},getNodeRadius:function(){return 25},getLinkDistance:function(e){var t,n,s=50;return e.source.r&&e.target.r?s+=e.source.r+e.target.r:(t=this.getNodeRadius(e.source),n=this.getNodeRadius(e.target),s+=t+n),s},getEventsObject:function(){var e={dragstart:s.partial(this.handleNodeDragStart,this),drag:s.partial(this.handleNodeDrag,this),dragend:s.partial(this.handleNodeDragEnd,this),mouseover:s.partial(this.handleMouseOver,this),mouseout:s.partial(this.handleMouseOut,this),click:s.partial(this.handleMouseClick,this),mouseup:s.partial(this.handleMouseUp,this),mousedown:s.partial(this.handleMouseDown,this)};return e},getNodeClassValue:function(){return"node"},getLinkClassValue:function(){return"link"},getVisibleNodes:function(){return this.nodes},redrawNodes:function(){n.select(this.selector+" .nodes").selectAll(".node").remove(),this.drawNodes()},redrawNode:function(e,s){(e||s)&&(e||s===i||(e=t(".node").get(s.index)),n.select(e).remove(),this.drawNodes())},drawNodes:function(){var e=this.getVisibleNodes(),t=n.select(this.selector+" .nodes").selectAll(".node").data(e,function(e,t){return e.hasOwnProperty("_id")?e._id:t}),s=t.enter().append("g");return this.drawNodeExit(t.exit()),this.attachNodeEvents(s),this.drawNodeEnter(s),this.node=t,this},attachNodeEvents:function(e){var t=this.getEventsObject();e.on("click",t.click).on("mouseover",t.mouseover).on("mouseout",t.mouseout).on("mouseup",t.mouseup).on("mousedown",t.mousedown).call(n.behavior.drag().on("dragstart",t.dragstart).on("drag",t.drag).on("dragend",t.dragend))},getNodeShapeGenerator:function(){var e=this.options.shapes.generator;return"symbol"==e?n.svg.symbol().type("circle").size(function(e){return Math.pow(r.getNodeRadius(e)*Math.PI,2)}):n.superformula().type("circle").size(function(e){return Math.pow(r.getNodeRadius(e)*Math.PI,2)}).segments(50)},drawNodeEnter:function(e){var n=this.getNodeShapeGenerator();e.attr("class",function(e){return r.getNodeClassValue(e)}),e.append("path").attr("d",function(e,t){var s=n(e,t);return e._shape={path:s,scale:{x:1,y:1},shape:"circle"},s}).attr("class","top-circle"),this.drawNodeTexts(e),t(this.kernel).trigger(l.DRAWN,[e])},drawNodeExit:function(e){e.remove()},splitNodeText:function(e,t){var n,s,i,r,a=e.length/2;if(t=t||10,!e||e.length<t||""===e)return[e];n=e.split(" "),i=n[0];for(var o=1;o<n.length;o++){if(s=n[o],r=Math.abs(a-i.length),!(Math.abs(a-(i.length+s.length+1))<r))return[i,n.slice(o).join(" ")];i+=" "+s}return[e]},getNodeTextDY:function(e,t){return 1>=t?5:-3},getNodeTitleKey:function(){return"name"},getNodeText:function(e){return e._properties[this.getNodeTitleKey()]},drawNodeTexts:function(e){var t=this,n=e.append("text").attr("text-anchor","middle");n.each(function(e){t.drawNodeText.apply(t,[this,e])})},drawNodeText:function(e,t){var s=this.getNodeText(t),i=[],r=n.select(e);if(s){r.text(""),i=this.splitNodeText(s),r.attr("dy",this.getNodeTextDY(t,i.length));for(var a=0;a<i.length;a++){var o=r.append("tspan").text(i[a]);a>0&&o.attr("x",0).attr("dy",20)}}},setNodeText:function(e,n){var s=t("text",e).get(0);this.drawNodeText(s,n)},getVisibleLinks:function(){return this.edges},redrawLinks:function(){n.select(this.selector+" .links").selectAll(".link").remove(),this.drawLinks()},drawLinks:function(){var e=this.getVisibleLinks(),t=n.select(this.selector+" .links").selectAll(".link").data(e,function(e){return e.source.index+"#"+e.target.index+"#"+e.type}),s=t.enter().append("polyline");return this.drawLinkExit(t.exit()),this.drawLinkEnter(s),this.link=t,this},drawLinkEnter:function(e){e.attr("class",function(e){return r.getLinkClassValue(e)})},drawLinkExit:function(e){e.remove()},getNodeFromData:function(e){return e?n.selectAll(".node").filter(function(t){return t.index==e.index}).node():null},resolveNode:function(e,t){return e?e:this.getNodeFromData(t)},getDataFromNode:function(e){return e?n.select(e).datum():null},resolveData:function(e,t){return t?t:this.getDataFromNode(e)},handleMouseOver:function(e,t){e.hoveredNode={data:t,node:this}},handleMouseOut:function(e){e.hoveredNode=null},handleMouseClick:function(e,s){n.event.defaultPrevented||t(e.kernel).trigger("node-clicked",[this,s])},handleMouseDown:function(e,n){t(e.kernel).trigger("mouse-down",[this,n])},handleMouseUp:function(e){t(e.kernel).trigger("mouse-up")},updateDragData:function(e,t){var n,s;this.draggedNode&&(this.xChange=this.xChange+e,this.yChange=this.yChange+t,n=Math.abs(this.xChange),s=Math.abs(this.yChange),this.dragDistance=Math.sqrt(Math.pow(n,2)+Math.pow(s,2)),this.xChange>0&&n>s?this.dragDirection=d.RIGHT:this.xChange<0&&n>s?this.dragDirection=d.LEFT:this.yChange>0&&s>n?this.dragDirection=d.DOWN:this.yChange<0&&s>n&&(this.dragDirection=d.UP))},handleNodeDrag:function(e,s){e.updateDragData(n.event.dx,n.event.dy),t(e.kernel).trigger(n.event,[this,s]),0==e.dragDistance||e.holding||(e.dragging=!0,this.style.pointerEvents="none",s.px+=n.event.dx,s.py+=n.event.dy,s.x+=n.event.dx,s.y+=n.event.dy,e.handleTick())},handleNodeDragStart:function(e,s){console.log("node drag start"),console.log(e),console.log(this),t(e.kernel).trigger(c.START,[this,s]),n.event.sourceEvent.stopPropagation(),e.xChange=0,e.yChange=0,e.draggedNode={data:s,node:this},e.force.stop()},handleNodeDragEnd:function(e,n){t(e.kernel).trigger(c.END,[this,n]),0!==e.dragDistance&&e.force.resume(),e.draggedNode.node.style.pointerEvents="auto",e.draggedNode=null,e.dragging=!1,e.dragDistance=0},handleWindowResize:function(){var n=t(e).width(),s=t(e).height();t(this.selector).attr("width",n).attr("height",s)},handleTick:function(){var e=this.link,t=this.node;t.attr("transform",function(e){var t="translate(__x__, __y__)",n=1e4,s=1e4,i=2*r.getNodeRadius(e),a={x:Math.max(i,Math.min(n-i,e.x)),y:Math.max(i,Math.min(s-i,e.y))};return e.x=a.x,e.y=a.y,t.replace(/__x__/g,a.x).replace(/__y__/g,a.y)}),e&&e.attr("points",function(e){return e.source.x+","+e.source.y+" "+(e.source.x+e.target.x)/2+","+(e.source.y+e.target.y)/2+" "+e.target.x+","+e.target.y})}})}(this,i,s,t),function(e,t,n,s){"use strict";{var i=(e.setNamespace("app.graph"),e.setNamespace("app.graph.graphics"));e.use("app.constants.NodeStatus")}i.scaleNode=function(e,t,i){var r=i.resolveData(t,s),a=r._shape.scale,o=a.x*e,h=a.y*e;n.select(t).selectAll(".top-circle").transition().duration(500).attr("d",r._shape.path).attr("transform","scale("+o+","+h+")")},i.classNode=function(e,t,s,i){s=n.select(s),console.log("classing node"),console.log(i.index),console.log(s),console.log(s.datum()),s.classed(e,t)},i.handleNodeScale=function(e,t,n){i.scaleNode(e,n,this.graph)},i.handleClassNode=function(e,t,n,s){i.classNode(e,!0,n,s,this.graph)},i.handleUnclassNode=function(e,t,n,s){i.classNode(e,!1,n,s,this.graph)},i.handleNodeColor=function(e,t,s){i.colorNodes(n.select(s),e,500)},i.colorNodes=function(e,t,n){e.selectAll(".top-circle").transition().duration(n).style("fill",t)},i.classNodes=function(e,t){e.each(function(e){n.select(this).classed(t(e))})},i.shapeNodes=function(e,t){var s;e.each(function(e){s=t(e),n.select(this).selectAll(".top-circle").transition().duration(500).attr("d",s.path).attr("transform","scale("+s.scale.x+","+s.scale.y+")")})}}(this,i,s),function(e,t,n){var s=e.setNamespace("app.model");const i="_id",r="_labels",a="_properties";s.Node={create:function(e,s,o){var h={};return h[a]=e||{},h[r]=s||[],h[i]=o===n?t.uniqueId():o,h},getId:function(t){return e.getObjectValueByPath(t,i)},getIdPath:function(){return i},getLabelsPath:function(e){var t=r;return e&&(t+="."+e),t},getPropertiesPath:function(e){var t=a;return e&&(t+="."+e),t},getLabels:function(t){return e.getObjectValueByPath(t,r)},getProperties:function(t){return e.getObjectValueByPath(t,a)},getPropertyValue:function(t,n){var s=this.getPropertiesPath(n);return e.getObjectValueByPath(t,s)},filterEdges:function(e,t){var n=this.getId(e);return t.filter(function(e){var t=this.getId(e.source),s=this.getId(e.target);return t===n||s===n},this)},hasProperty:function(t,s){var i=this.getPropertiesPath(s);return e.getObjectValueByPath(t,i)!==n},hasPropertyWithValue:function(t,n,s){var i=this.getPropertiesPath(n),r=e.getObjectValueByPath(t,i);return s===r},hasLabel:function(e,t){var n=s.Node.getLabels(e);return-1!==n.indexOf(t)}}}(this,t),function(e,t){"use strict";var n=e.setNamespace("app.model"),s=e.use("app.model.Node");n.Update=app.createClass({construct:function(){this._set=[],this._unset=[],this.difference,this.paths,this.count},set:function(e,t){this._set.push([e,t])},unset:function(e,t){this._unset.push([e,t])},setProperties:function(e){this.set(s.getPropertiesPath(),e)},setProperty:function(e,t){this.set(s.getPropertiesPath(e),t)},unsetProperty:function(e){this.unset(s.getPropertiesPath(e))},setLabels:function(e){this.set(s.getLabelsPath(),e)},setLabel:function(e){this.set(s.getLabelsPath(-1),e),console.log(this)},unsetLabel:function(e){this.unset(s.getLabelsPath(),e)},process:function(n){var s,i,r,a=this._set,o=this._unset,h=t.cloneDeep(n);if(o)for(s=0;s<o.length;s++)i=o[s],e.removeByPath(n,i[0],i[1]);if(a)for(s=0;s<a.length;s++)i=a[s],e.setByPath(n,i[0],i[1]);r=DeepDiff.diff(h,n),this.prepareDifference(r)},prepareDifference:function(e){var t,n,s,i,r={},a=0;if(e=e||[],this.difference=e,!e)return this.paths=r,void(this.count=0);for(s=0;s<e.length;s++)if(n=e[s],n.path){for(t="",i=0;i<n.path.length;i++)""!==t&&(t+="."),t+=n.path[i],r[t]=1;a++}this.paths=r,this.count=a},changed:function(e){return this.paths.hasOwnProperty(e)}})}(this,t),function(e,t,n){"use strict";var s=e.setNamespace("app.modules"),i=e.use("app"),r=e.use("app.model.Node"),a=e.use("app.graph.graphics"),o=e.use("app.constants.EvaluationStrategy"),h={strategy:o.PROPERTY,labels:{},labelPriority:[],properties:{},propertyPriority:[]};s.Classable=i.createClass({construct:function(e){this.options=t.extend({},h,e)},classNodeByProperty:function(e){var t,n,s,i,r,a=this.options.properties,o={};for(n in a){i=e._properties[n],s=a[n];for(r in s)s.hasOwnProperty(r)&&(t=s[r],o[t]=r===i?!0:!1)}return o},handleClassNodes:function(e,t,s,i){var h=this.options.strategy;if(i){if(!i.changed(r.getPropertiesPath())&&!i.changed(r.getLabelsPath()))return;t=n.select(t)}h===o.PROPERTY&&a.classNodes(t,this.classNodeByProperty.bind(this))}})}(this,i,s),function(e,t,n){"use strict";var s=e.setNamespace("app.modules"),i=e.use("app"),r=e.use("app.graph.graphics"),a=e.use("app.constants.EvaluationStrategy"),o={numColors:10,strategy:a.PROPERTY,defaultValue:"#d2d2d2",labels:{},labelPriority:[],properties:{},propertyPriority:[]};s.Colorable=i.createClass({construct:function(e){this.colorMap={},this.colorCount=0,this.colors=n.scale.category10(),this.options=t.extend({},o,e)},colorNodeByLabel:function(e){var t,n,s=this.options.defaultColor,i=this.options.labels;return e._labels&&e._labels.length>0&&(n=e._labels[0],this.colorMap.hasOwnProperty(n)||(i.hasOwnProperty(n)?this.colorMap[n]=i[n]:(t=this.colorCount%this.options.numColors,this.colorMap[n]=this.colors(t),this.colorCount++)),s=this.colorMap[n]),s},colorNodeByProperty:function(e){var t,n,s,i,r=this.options.defaultColor,a=this.options.properties,o=this.options.propertyPriority,h=0!==o.length,d=-1;for(t in a)e.hasOwnProperty(t)&&(i=e[t],s=a[t],s.hasOwnProperty(i)&&(n=o.indexOf(t),h&&-1!==n&&d>n?(r=s[i],d=n):-1===d&&(r=s[i])));return r},handleColorNodes:function(e,t,s,i){var o=this.options.strategy,h=0;if(i){if(!i.changed(Node.getPropertiesPath())&&!i.changed(Node.getLabelsPath()))return;t=n.select(t),h=500}o===a.PROPERTY?r.colorNodes(t,this.colorNodeByProperty.bind(this),h):r.colorNodes(t,this.colorNodeByLabel.bind(this),h)}})}(this,i,s),function(e,t,n,s){"use strict";var i,r=(e.setNamespace("app.graph"),e.setNamespace("app.modules")),a=e.use("app"),o=e.use("app.event.EdgeEvent");r.EdgeCRUD=a.createClass({construct:function(e){this.options=t.extend({},i,e)},initialize:function(){t(this.kernel).on(o.CREATE,this.handleCreateEdge.bind(this)).on(o.DESTROY,this.handleDestroyEdge.bind(this))},handleLinking:function(){console.log("handling linking"),this.graph.dragging&&this.graph.draggedNode&&this.graph.hoveredNode&&this.updateLink(this.graph.draggedNode.data,this.graph.hoveredNode.data)},handleCreateEdge:function(e,t,n){console.log("handling edge creation"),this.updateLink(t,n,s,2)},handleDestroyEdge:function(e,t,n){console.log("handling edge deletion"),this.updateLink(t,n,s,1)},handleUpdateEdge:function(){},resolveEdgeType:function(){return"POINTS_TO"},indexOfEdge:function(e,t,n){var s=-1;return this.graph.edges.forEach(function(i,r){n&&i.type!==n||(i.source.index==e.index&&i.target.index==t.index||i.source.index==t.index&&i.target.index==e.index)&&(s=r)}),s},create:function(e){return e.hasOwnProperty("source")&&e.hasOwnProperty("target")&&e.hasOwnProperty("type")?(this.graph.edges.push(e),void t(this.kernel).trigger(o.CREATED,[e,source,target])):null},replace:function(e,n){var s=this.graph.edges[e];this.graph.edges[e]=n,t(this.kernel).trigger(o.REPLACED,[n,s])},updateLink:function(e,n,i,r){var a,h=this.indexOfEdge(e,n,i);i=i===s?this.resolveEdgeType(e,n):i,e.index!=n.index&&(console.log("ACTION: "+r),r||(r=-1===h?2:1),console.log("ACTION: "+r),-1===h&&2===r?(a={source:e.index,target:n.index,type:i},this.graph.edges.push(a),t(this.kernel).trigger(o.CREATED,[a,e,n])):h>=0&&1===r&&(a=this.graph.edges[h],this.graph.edges.splice(h,1),t(this.kernel).trigger(o.DESTROYED,[a])),this.graph.drawLinks(),this.graph.force.start())}})}(this,i,s),function(e,t,n,s){"use strict";var i=e.setNamespace("app.modules"),r=e.use("app"),a=e.use("app.model.Node"),o=(e.use("app.graph.graphics"),e.use("app.constants.EvaluationStrategy")),h={strategy:o.LABEL,labels:{},labelPriority:[],properties:{},propertyPriority:[]};i.Evaluable=r.createClass({construct:function(e){this.options=t.extend({},h,e)},evaluateLabels:function(e){var t,n,s=this.options.defaultValue,i=this.options.labels,r=this.options.labelPriority,o=0!==r.length,h=-1;if(!s)throw"Default value not specified";for(t in i)a.hasLabel(e,t)&&(n=r.indexOf(t),o&&-1!==n&&h>n?(s=i[t],h=n):-1===h&&(s=i[t]));return s},evaluateProperties:function(e){var t,n,i,r,o=this.options.defaultValue,h=this.options.properties,d=this.options.propertyPriority,l=0!==d.length,c=-1;if(!o)throw"Default value not specified";for(t in h)i=a.getPropertyValue(e,t),i!==s&&(n=h[t],n.hasOwnProperty(i)&&(r=d.indexOf(t),l&&-1!==r&&c>r?(o=n[i],c=r):-1===c&&(o=n[i])));return o}})}(this,i,s),function(e,t,n,s){"use strict";var i=e.setNamespace("app.modules"),r=e.use("app");i.Filterable=r.createClass({initialize:function(){},drawNodeOverlay:function(e){var t=this;e.append("svg:circle").attr("class","overlay").attr("r",function(){var e=2*t.graph.getNodeRadius();return e})},filter:function(e){var t=[];return n.selectAll(".node").classed("filtered",function(n){var s,i,r;r=new RegExp(e,"i");for(s in n._properties)if(n._properties.hasOwnProperty(s)&&(i=String(n._properties[s]),i.match(r)))return t.push(n),!1;return!0}),t},resetFilter:function(){n.selectAll(".filtered").classed("filtered",!1)},handleNodeDrawn:function(e,t){this.drawNodeOverlay(t)},handleNodeFilter:function(e,n){var i=this.filter(n);t(this.kernel).trigger("node-filtered",[s,i])},handleNodeFilterUnset:function(){this.resetFilter()}})}(this,i,s),function(e,t,n){"use strict";var s=e.setNamespace("app.modules"),i=e.use("app"),r=e.use("app.model.Node"),a=e.use("app.graph.graphics"),o=e.use("app.constants.EvaluationStrategy"),h={strategy:o.PROPERTY,defaultValue:!0,labels:{},labelPriority:[],properties:{},propertyPriority:[]};s.Hidable=i.createClass(s.Evaluable,{construct:function(e){this.options=t.extend({},h,e),this.baseOptions=t.extend({},h,e),this.filter={}},initialize:function(){t(this.kernel).on("graph-mode-changed",this.handleHideNodes.bind(this))},hideNodeByLabel:function(e){var t=this.evaluateLabels(e);return t},hideNodeByProperty:function(e){var t=this.evaluateProperties(e);return t},handleHideNodes:function(e,t,s,i){{var h=this.options.strategy;this.graph}if(i){if(!i.changed(r.getPropertiesPath())&&!i.changed(r.getLabelsPath()))return;t=n.select(t)}h===o.PROPERTY?(console.log("shaping by property"),a.shapeNodes(t,this.shapeNodeByProperty.bind(this))):a.shapeNodes(t,this.shapeNodeByLabel.bind(this))}})}(this,i,s),function(e,t){"use strict";var n,s=e.setNamespace("app.modules"),i=e.use("app"),r=e.use("app.constants.Drag"),a=e.use("app.event.HoldEvent"),o={duration:500};s.Holdable=i.createClass({construct:function(e){n=this,this.options=t.extend({},o,e)},initialize:function(){this.graph.holdActions={},this.graph.holdActions[r.LEFT]="None",this.graph.holdActions[r.RIGHT]="None",this.graph.holdActions[r.UP]="None",this.graph.holdActions[r.DOWN]="None"},handleHoldStart:function(e,s,i,r){var o=this.graph;this.holdTimeoutId=window.setTimeout(function(){o.dragging||(console.log("holding"),o.holding=!0,s?t(n.kernel).trigger(a.NODE,[s,i]):(t(n.kernel).trigger(a.CANVAS,[{},r]),o.holding=!1))},this.options.duration)},handleHoldDrag:function(e){var t;this.graph.holding&&(e.sourceEvent.preventDefault(),t=this.graph.dragDistance>100?this.graph.holdActions[this.graph.dragDirection]:"Too close")},handleHoldEnd:function(e,n,s){if(window.clearTimeout(this.holdTimeoutId),n){if(this.graph.holding&&this.graph.dragDistance>100)switch(this.graph.dragDirection){case r.LEFT:t(this.kernel).trigger(a.DRAGLEFT,[n,s]);break;case r.RIGHT:t(this.kernel).trigger(a.DRAGRIGHT,[n,s]);break;case r.UP:t(this.kernel).trigger(a.DRAGUP,[n,s]);break;case r.DOWN:t(this.kernel).trigger(a.DRAGDOWN,[n,s])}this.graph.dragging=!1,this.graph.holding=!1}}})}(this,i,s),function(e,t){"use strict";var n=e.setNamespace("app.modules"),s=e.use("app"),i=e.use("app.model.Node"),r={link:["link"]};n.Hyperlinkable=s.createClass({construct:function(e){this.options=t.extend({},r,e)},checkURI:function(){return!0},followLink:function(e){window.open(e)},handleFollowLink:function(e,t,n){var s,r,a,o=this.options.link,h=[];for(a=0;a<o.length;a++)s=o[a],r=i.getPropertyValue(n,s),r&&this.checkURI(r)&&h.push(r);h.length>0?this.followLink(h[0]):console.log("no links")}})}(this,i,s),function(e,t){"use strict";var n=e.setNamespace("app.modules"),s=(e.setNamespace("app.transformer"),e.use("app")),i=e.use("app.model"),r=e.use("app.event.NodeEvent"),a=e.use("app.event.EdgeEvent"),o={properties:{},labels:[]};n.NodeCRUD=s.createClass({construct:function(e){this.options=t.extend({},o,e)},initialize:function(){t(this.kernel).on(r.CREATE,this.handleNodeCreate.bind(this)).on(r.UPDATE,this.handleUpdate.bind(this)).on(r.DESTROY,this.handleNodeDestroy.bind(this))},createNode:function(e,n,s,a){console.log("creating node, x: "+s+", y: "+a);var o,h,d,l,c=this.options.properties,u=this.options.labels;for(o in c)c.hasOwnProperty(o)&&(e.hasOwnProperty(o)||(e[o]=c[o]));for(l=0;l<u.length;l++)h=u[l],-1===n.indexOf(h)&&n.push(h);return d=i.Node.create(e,n),d.x=s||0,d.y=a||0,this.graph.nodes.push(d),this.graph.drawNodes(),this.graph.handleTick(),this.graph.force.start(),t(this.kernel).trigger(r.CREATED,[null,d]),d},deleteEdgesForNode:function(e){for(var t,n=this.graph.edges,s=n.length-1;s>=0;s--)t=n[s],(t.source.index==e||t.target.index==e)&&n.splice(s,1)},destroyNode:function(e){if(confirm("destroy node?")){var n=this.graph;this.deleteEdgesForNode(e.index),n.nodes.splice(e.index,1),n.drawLinks(),n.redrawNodes(),n.force.start(),t(this.kernel).trigger(r.DESTROYED,[e])}},updateNode:function(e,n,s){e=this.graph.resolveNode(e,n),n=this.graph.resolveData(e,n),s.process(n),s.count&&(this.graph.setNodeText(e,n),t(this.kernel).trigger(r.UPDATED,[e,n,s]))},handleCreateChildNode:function(e,n,s){var i=this.createNode({},[],s.x,s.y);t(this.kernel).trigger(a.CREATE,[s,i]).trigger(r.SELECT,[null,i])},handleNodeCreate:function(e,t,n){var s;e.preventDefault(),e.stopPropagation(),n||(n={x:0,y:0}),s=this.createNode(t,[],n.x,n.y)},handleUpdate:function(e,t,n,s){return e.preventDefault(),e.stopPropagation(),console.log("handling node update"),s?void this.updateNode(t,n,s):void console.log("no update passed")},handleNodeDestroy:function(e,t,n){this.destroyNode(n)}})}(this,i,s,t),function(e,t){"use strict";var n=e.setNamespace("app.modules"),s=e.use("app");n.Pinnable=s.createClass({handleNodePinned:function(e,n,s){s.fixed=!s.fixed,t(this.kernel).trigger("node-pinned",[n,s])}})}(this,i),function(e,t){"use strict";var n=e.setNamespace("app.modules"),s=e.use("app"),i=e.use("app.event.NodeEvent");n.Selectable=s.createClass({construct:function(){this.selectedNode=null},initialize:function(){t(this.kernel).on(i.SELECT,this.handleNodeSelect.bind(this)).on(i.UNSELECT,this.handleNodeUnselect.bind(this))},handleNodeSelect:function(e,n,s){console.log("selecting"),console.log(s),console.log(n);var r=this.selectedNode;if(r){if(r.data.index==s.index)return;t(this.kernel).trigger(i.UNSELECT,[r.node,r.data])}n=this.graph.resolveNode(n,s),s=this.graph.resolveData(n,s),this.selectedNode={node:n,data:s},t(this.kernel).trigger(i.SELECTED,[n,s])},handleNodeUnselect:function(e,n,s){var r=this.selectedNode;s?t(this.kernel).trigger(i.UNSELECTED,[n,s]):r&&t(this.kernel).trigger(i.UNSELECTED,[r.node,r.data]),r&&(this.selectedNode=null)}})}(this,i,s),function(e,t,n){"use strict";var s=e.setNamespace("app.modules"),i=e.use("app"),r=e.use("app.model.Node"),a=e.use("app.graph.graphics"),o=e.use("app.constants.EvaluationStrategy"),h={strategy:o.PROPERTY,defaultValue:"circle",directMapping:!0,paths:{},shapes:{},labels:{},labelPriority:[],properties:{},propertyPriority:[]};
s.Shapable=i.createClass(s.Evaluable,{construct:function(e){this.options=t.extend({},h,e)},getShapeObject:function(e,t){var s,i,r,a,o=this.options.shapes,h=this.options.paths;return o.hasOwnProperty(e)?(s=o[e],i=s[0],a={x:s[1],y:s[2]}):(i=e,a={x:1,y:1}),r=h.hasOwnProperty(i)?h[i]:n.superformula().type(i).size(t).segments(50),{shape:e,path:r,scale:a}},getSizeFromRadius:function(e){return Math.pow(3*e,2)},shapeNodeByLabel:function(e){var t,n;return t=this.evaluateLabels(e),n=this.getSizeFromRadius(this.graph.getNodeRadius(e)),e._shape=this.getShapeObject(t,n),e._shape},shapeNodeByProperty:function(e){var t,n;return t=this.evaluateProperties(e),n=this.getSizeFromRadius(this.graph.getNodeRadius(e)),e._shape=this.getShapeObject(t,n),e._shape},handleShapeNodes:function(e,t,s,i){{var h=this.options.strategy;this.graph}if(i){if(!i.changed(r.getPropertiesPath())&&!i.changed(r.getLabelsPath()))return;t=n.select(t)}h===o.PROPERTY?a.shapeNodes(t,this.shapeNodeByProperty.bind(this)):a.shapeNodes(t,this.shapeNodeByLabel.bind(this))}})}(this,i,s),function(e,t){"use strict";var n=e.setNamespace("app.modules"),s=e.use("app"),i=e.use("app.model"),r=e.use("app.event.NodeEvent"),a={path:"_style",storables:{}};n.Storable=s.createClass({construct:function(e){this.options=t.extend({},a,e)},initialize:function(){t(this.kernel).on(r.LOADED,this.handleGraphLoaded.bind(this))},objectToString:function(e){return JSON.stringify(e)},objectFromString:function(e){return JSON.parse(e)},getStorableString:function(t,n){var s,i,r,a,o,h,d,l=this.options.storables,c={};for(s in l){for(d={},i=l[s],r=0;r<i.length;r++)a=i[r],o=e.getObjectValueByPath(n,a),d[a]=o;c[s]=d}return h=this.objectToString(c)},parseStorableString:function(t){var n,s,i,r,a=this.options.storables,o=this.options.path;if(t.hasOwnProperty(o)){s=this.objectFromString(t[o]);for(n in s)if(a.hasOwnProperty(n)){i=s[n];for(r in i)e.setByPath(t,r,i[r])}}},handleGraphLoaded:function(e,t){var n,s;for(n=0;n<t.length;n++)s=t[n],this.parseStorableString(s)},handleNodeStyled:function(e,n,s){if(s.fixed){var a=this.getStorableString(n,s),o=new i.Update;o.set(this.options.path,a),t(this.kernel).trigger(r.UPDATE,[n,s,o])}}})}(this,i,s),function(e,t){"use strict";var n,s=e.setNamespace("app.modules"),i=e.use("app"),r=e.use("app.model"),a=e.use("app.event.NodeEvent"),o=e.use("app.constants.NodeStatus");s.Validatable=i.createClass({construct:function(e){this.options=t.extend({},n,e)},setNodeStatus:function(e,n,s){var i;n._properties.hasOwnProperty("status")&&n._properties.status===s||(i=new r.Update,i.setProperty("status",s),t(this.kernel).trigger(a.UPDATE,[e,n,i]))},handleDenyNode:function(e,t,n){this.setNodeStatus(t,n,o.DENIED)},handleAcceptNode:function(e,t,n){this.setNodeStatus(t,n,o.ACCEPTED)}})}(this,i,t),function(e,t,n,s){"use strict";var i,r=e.setNamespace("app.modules"),a=e.use("app");r.Zoomable=a.createClass({construct:function(e){this.options=t.extend({},i,e)},initialize:function(){var e=s.bind(this.handleZoom,this),i=s.bind(this.handleZoomStart,this),r=s.bind(this.handleZoomEnd,this);n.select(this.graph.selector+" .graph-viewport").call(n.behavior.zoom().on("zoom",e).on("zoomstart",i).on("zoomend",r)),this.options.doubleclick||n.select(this.graph.selector+" .graph-viewport").on("dblclick.zoom",null),this.elem=t(".graph-content",this.graph.selector).get(0)},handleZoom:function(){var e=n.mouse(this.elem),t=this.dragStartPosition[0]-e[0],s=this.dragStartPosition[1]-e[1];(0!=t||0!=s)&&(this.graph.dragging=!0);var i="translate(__translate__) scale(__scale__)",r=i.replace(/__translate__/g,n.event.translate).replace(/__scale__/g,n.event.scale);n.select(this.graph.selector).select(".graph-content").attr("transform",r)},handleZoomStart:function(){this.dragStartPosition=n.mouse(this.elem)},handleZoomEnd:function(){this.graph.dragging=!1}})}(this,i,s,t),function(e,t){"use strict";var n=e.setNamespace("app.transformer"),s=e.use("app"),i={map:{}};n.AbstractDataTransformer=s.createClass({construct:function(e){this.options=t.extend({},i,e)},from:function(){throw'The data transformer should implement a "from" function'},to:function(){throw'The data transformer should implement a "to" function'},getMappedProperties:function(e){return this.filterAndChangePropertyKeys(e,this.options.map)},filterAndChangePropertyKeys:function(e,t){var n,s,i,r={};for(s in t)t.hasOwnProperty(s)&&(n=t[s],i=e[n],i&&(r[s]=i));return r}})}(this,i),function(e){"use strict";var t=e.setNamespace("app.transformer"),n=e.use("app");t.D3Transformer=n.createClass(t.AbstractDataTransformer,{from:function(e){return e},to:function(e){return e}})}(this),function(t){t.Nodium=e("./nodium")}(window),this.app}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./nodium":2}]},{},[1]);